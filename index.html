<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RealmSMP Economy</title>
<style>
body { 
  font-family: Arial, sans-serif; 
  background-color: #1a1a1a; 
  color: #f0f0f0; 
  margin: 0; 
  padding: 0; 
  background-image: url('images/bg2.png');
  background-size: cover;
  background-position: center;
}

h1 { 
  text-align: center; 
  margin: 20px 0; 
  color: #ffd700; 
}

h2 {
  margin: 10px 0;
  color: #ffd700;
}

#searchBar { 
  display: block; 
  margin: 0 auto 20px auto; 
  padding: 10px; 
  width: 90%; 
  max-width: 400px; 
  border-radius: 5px; 
  border: none; 
  font-size: 16px; 
}

.itemCard {
  background: rgba(255, 255, 255, 0.1);
  border-radius: 15px;
  padding: 15px;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  height: 250px;
  transition: transform 0.2s, box-shadow 0.2s, background 0.2s;
  backdrop-filter: blur(10px);
  transform-style: preserve-3d;
}

canvas { width: 100%; height: 100px; }

#logoContainer { text-align:center; margin:20px 0; }
#logoContainer img { max-width: 80%; height: auto; }
</style>
</head>
<body>

<div id="logoContainer">
  <img id="logoImg" src="images/logo.png" alt="RealmSMP Economy Logo">
</div>

<input type="text" id="searchBar" placeholder="Search items...">
<div id="itemsContainer"></div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
let itemsData = [];

const API_KEY = "AIzaSyBpS-W-kviLJP0avh1mdd0YQmChkkhqTLM";
const SHEET_ID = "1o_SdEJFe1uO5OnjhX08BFd-nfxxBc_YmRKqN5u1lG58";
const RANGE = "Sheet1!A2:G"; 

fetch(`https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${RANGE}?key=${API_KEY}`)
  .then(res => res.json())
  .then(data => {
    const rows = data.values || [];
    itemsData = rows.map((cols,index)=>{
      try{
        return {
          id: cols[0].trim(),       
          name: cols[1].trim(),
          buy: Number(cols[2]),
          sell: Number(cols[3]),
          history: JSON.parse(cols[4]||"[]"),
          hoverKey: cols[5] ? cols[5].trim().toLowerCase() : 'default',
          npc: cols[6] ? cols[6].trim() : "Unknown"
        };
      }catch(err){
        return null;
      }
    }).filter(item=>item!==null);
    displayItems(itemsData);
  });

function getIconURL(id){
  return `images/${id}.png`;
}

function createItemCard(item){
  const card=document.createElement('div');
  card.className='itemCard';

  const color = "#ffd700";

  card.addEventListener('mousemove', (e) => {
    const rect = card.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const y = e.clientY - rect.top;
    const centerX = rect.width / 2;
    const centerY = rect.height / 2;

    const normX = (x - centerX) / centerX;
    const normY = (y - centerY) / centerY;

    const rotateX = -normY * 10;
    const rotateY = normX * 10;

    card.style.transform = `rotateX(${rotateX}deg) rotateY(${rotateY}deg) scale(1.05)`;

    const gradientX = normX * 50 + 50;
    const gradientY = normY * 50 + 50;
    card.style.background = `radial-gradient(circle at ${gradientX}% ${gradientY}%, rgba(255,255,255,0.3), rgba(75,75,75,0.6))`;

    card.style.boxShadow = `${normX*10}px ${-normY*10}px 30px ${color}, 0 8px 15px rgba(0,0,0,0.6)`;
  });

  card.addEventListener('mouseleave', () => {
    card.style.transform = 'rotateX(0deg) rotateY(0deg) scale(1)';
    card.style.boxShadow = '0 4px 10px rgba(0,0,0,0.5)';
    card.style.background = 'rgba(255,255,255,0.1)';
  });

  const top=document.createElement('div');
  top.style.display='flex';
  top.style.justifyContent='space-between';
  top.style.alignItems='center';

  const left=document.createElement('div');
  left.style.flex='1';

  const name=document.createElement('div');
  name.style.fontWeight='bold';
  name.textContent=item.name;

  const price=document.createElement('div');
  price.style.marginBottom='10px';
  price.textContent=`Buy: ${item.buy} | Sell: ${item.sell}`;

  const canvas=document.createElement('canvas');
  const ctx=canvas.getContext('2d');
  new Chart(ctx,{
    type:'line',
    data:{
      labels:item.history.map((_,i)=>i+1),
      datasets:[{
        data:item.history,
        borderColor:'#ffd700',
        backgroundColor:'rgba(255,215,0,0.2)',
        tension:0.3,
        pointRadius:2
      }]
    },
    options:{
      responsive:false,
      maintainAspectRatio:true,
      plugins:{legend:{display:false}},
      scales:{y:{beginAtZero:false}}
    }
  });

  left.appendChild(name);
  left.appendChild(price);
  left.appendChild(canvas);

  const img=document.createElement('img');
  img.src=getIconURL(item.id);
  img.alt=item.name;
  img.onerror=()=> img.src='images/placeholder.png';
  img.style.width='96px';
  img.style.height='96px';
  img.style.marginLeft='15px';

  top.appendChild(left);
  top.appendChild(img);
  card.appendChild(top);
  return card;
}

function displayItems(items){
  const container = document.getElementById('itemsContainer');
  container.innerHTML='';

  const npcGroups = {};
  items.forEach(item => {
    const npc = item.npc || "Unknown";
    if(!npcGroups[npc]) npcGroups[npc] = [];
    npcGroups[npc].push(item);
  });

  Object.keys(npcGroups).forEach(npc => {
    const section = document.createElement('div');
    section.style.marginBottom="45px";

    const topBar=document.createElement('div');
    topBar.style.display="flex";
    topBar.style.alignItems="center";
    topBar.style.gap="15px";
    topBar.style.padding="0 20px";

    const title=document.createElement('h2');
    title.textContent=npc;

    const npcImg=document.createElement('img');
    const iconName = npc.toLowerCase().replace(/ /g,"_");
    npcImg.src=`images/${iconName}.png`;
    npcImg.style.width="64px";
    npcImg.style.height="64px";
    npcImg.style.borderRadius="8px";
    npcImg.style.objectFit="cover";
    npcImg.onerror = ()=> npcImg.src="images/npc_default.png";

    topBar.appendChild(npcImg);
    topBar.appendChild(title);

    const grid=document.createElement('div');
    grid.style.display="grid";
    grid.style.gridTemplateColumns="repeat(5, 1fr)";
    grid.style.gap="15px";
    grid.style.padding="10px 20px";

    npcGroups[npc].forEach(item => {
      grid.appendChild(createItemCard(item));
    });

    section.appendChild(topBar);
    section.appendChild(grid);
    container.appendChild(section);
  });
}

document.getElementById('searchBar').addEventListener('input', e=>{
  const term = e.target.value.toLowerCase();
  const filtered = itemsData.filter(item => item.name.toLowerCase().includes(term));
  displayItems(filtered);
});

document.getElementById("logoImg").onerror = () => {
  document.getElementById("logoImg").src = "images/npc_default.png";
};
</script>

</body>
</html>
