<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RealmSMP Economy</title>
<style>
body { 
  font-family: Arial, sans-serif; 
  background-color: #1a1a1a; 
  color: #f0f0f0; 
  margin: 0; 
  padding: 0; 
  background-image: url('https://dl.dropboxusercontent.com/s/7tohhrt5olvb434fwvd61/News_header_image_1920px_MC_Deep_Dark_2d937d3028.jpg?rlkey=81hu6jzqkg7bv2z1bvbah798e&st=2y710y9b&dl=0');
  background-size: cover;
  background-position: center;
}

h1 { 
  text-align: center; 
  margin: 20px 0; 
  color: #ffd700; 
}

#searchBar { 
  display: block; 
  margin: 0 auto 20px auto; 
  padding: 10px; 
  width: 90%; 
  max-width: 400px; 
  border-radius: 5px; 
  border: none; 
  font-size: 16px; 
}

#itemsContainer {
  display: grid;
  gap: 15px;
  padding: 10px 20px;
  grid-template-columns: repeat(5, 1fr);
}

@media (max-width: 1200px) { #itemsContainer { grid-template-columns: repeat(4, 1fr); } }
@media (max-width: 900px) { #itemsContainer { grid-template-columns: repeat(3, 1fr); } }
@media (max-width: 600px) { #itemsContainer { grid-template-columns: repeat(2, 1fr); } }
@media (max-width: 400px) { #itemsContainer { grid-template-columns: 1fr; } }

.itemCard {
  background: rgba(255, 255, 255, 0.1);
  border-radius: 15px;
  padding: 15px;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  height: 250px;
  transition: transform 0.2s, box-shadow 0.2s, background 0.2s;
  backdrop-filter: blur(10px);
  transform-style: preserve-3d;
}

.itemName { font-weight: bold; margin-bottom: 5px; }
.itemPrice { margin-bottom: 10px; }
canvas { width: 100%; height: 100px; }

#logoContainer { text-align:center; margin:20px 0; }
#logoContainer img { max-width: 80%; height: auto; }
</style>
</head>
<body>

<div id="logoContainer">
  <img src="https://dl.dropboxusercontent.com/s/ua1h1mmn7z7pmikufqnkz/REALMSMP-ECONOMY-30-12-2025.png" alt="RealmSMP Economy Logo">
</div>

<input type="text" id="searchBar" placeholder="Search items...">
<div id="itemsContainer"></div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
let itemsData = [];

const itemColors = {
  diamond: '#00bfff',
  gold_ingot: '#ffd700',
  iron_ingot: '#c0c0c0',
  sugar_cane: '#32cd32',
  barrier: '#e62315',
  default: '#ffffff'
};

const API_KEY = "AIzaSyBpS-W-kviLJP0avh1mdd0YQmChkkhqTLM";
const SHEET_ID = "1o_SdEJFe1uO5OnjhX08BFd-nfxxBc_YmRKqN5u1lG58";
const RANGE = "Sheet1!A2:F"; 

fetch(`https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${RANGE}?key=${API_KEY}`)
  .then(res => res.json())
  .then(data => {
    const rows = data.values || [];
    itemsData = rows.map((cols,index)=>{
      try{
        return {
          id: cols[0].trim(),       
          name: cols[1].trim(),
          buy: Number(cols[2]),
          sell: Number(cols[3]),
          history: JSON.parse(cols[4]||"[]"),
          hoverKey: cols[5] ? cols[5].trim().toLowerCase() : 'default'
        };
      }catch(err){
        console.error(`Error in row ${index+2}`,err);
        return null;
      }
    }).filter(item=>item!==null);
    displayItems(itemsData);
  })
  .catch(err=>console.error("Error fetching data:",err));

function getIconURL(id){
  return `images/${id}.png`;
}

function displayItems(items){
  const container = document.getElementById('itemsContainer');
  container.innerHTML='';

  items.forEach(item=>{
    const card=document.createElement('div');
    card.className='itemCard';
    const color = itemColors[item.hoverKey] || itemColors.default;

    // Liquid glass tilt + light reflection
    card.addEventListener('mousemove', (e) => {
      const rect = card.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;
      const centerX = rect.width / 2;
      const centerY = rect.height / 2;

      const normX = (x - centerX) / centerX;
      const normY = (y - centerY) / centerY;

      const rotateX = -normY * 10;
      const rotateY = normX * 10;

      card.style.transform = `rotateX(${rotateX}deg) rotateY(${rotateY}deg) scale(1.05)`;

      const gradientX = normX * 50 + 50;
      const gradientY = normY * 50 + 50;
      card.style.background = `
        radial-gradient(circle at ${gradientX}% ${gradientY}%, rgba(255,255,255,0.3), rgba(75,75,75,0.6))
      `;

      card.style.boxShadow = `${normX*10}px ${-normY*10}px 30px ${color}, 0 8px 15px rgba(0,0,0,0.6)`;
    });

    card.addEventListener('mouseleave', () => {
      card.style.transform = 'rotateX(0deg) rotateY(0deg) scale(1)';
      card.style.boxShadow = '0 4px 10px rgba(0,0,0,0.5)';
      card.style.background = 'rgba(255,255,255,0.1)';
    });

    const topContainer=document.createElement('div');
    topContainer.style.display='flex';
    topContainer.style.justifyContent='space-between';
    topContainer.style.alignItems='center';

    const leftSide=document.createElement('div');
    leftSide.style.flex='1';

    const name=document.createElement('div');
    name.className='itemName';
    name.textContent=item.name;

    const price=document.createElement('div');
    price.className='itemPrice';
    price.textContent=`Buy: ${item.buy} | Sell: ${item.sell}`;

    const canvas=document.createElement('canvas');
    const ctx=canvas.getContext('2d');
    new Chart(ctx,{
      type:'line',
      data:{
        labels:item.history.map((_,i)=>i+1),
        datasets:[{
          label:'Price History',
          data:item.history,
          borderColor:'#ffd700',
          backgroundColor:'rgba(255,215,0,0.2)',
          tension:0.3,
          pointRadius:2
        }]
      },
      options:{
        responsive:false,
        maintainAspectRatio:true,
        plugins:{legend:{display:false}},
        scales:{y:{beginAtZero:false,min:Math.min(...item.history)-5,max:Math.max(...item.history)+5}}
      }
    });

    leftSide.appendChild(name);
    leftSide.appendChild(price);
    leftSide.appendChild(canvas);

    const img=document.createElement('img');
    img.src=getIconURL(item.id);
    img.alt=item.name;
    img.onerror=()=>{ img.src='images/placeholder.png'; }; 
    img.style.width='96px';
    img.style.height='96px';
    img.style.marginLeft='15px';

    topContainer.appendChild(leftSide);
    topContainer.appendChild(img);
    card.appendChild(topContainer);
    container.appendChild(card);
  });
}

document.getElementById('searchBar').addEventListener('input', e=>{
  const searchTerm = e.target.value.toLowerCase();
  const filtered = itemsData.filter(item => item.name.toLowerCase().includes(searchTerm));
  displayItems(filtered);
});
</script>

</body>
</html>
